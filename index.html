<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Ruby-nagios by ripienaar</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>Ruby-nagios</h1>
        <p>A CLI tool and Ruby library that parses your status log file and let you query it for information or create external commands</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/ripienaar/ruby-nagios" class="button fork"><strong>Fork On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/ripienaar/ruby-nagios/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/ripienaar/ruby-nagios/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>

      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h1>What?</h1>

<p>Have you ever had to disable alerts, retry a check
or acknowledge outages on a large amount of service
with Nagios and hated the web UI for it?</p>

<p>This is a CLI tool and Ruby library that parses your
status log file and let you query it for information
or create external commands to be piped into the nagios
command file.</p>

<p>You can get this software here on GitHub or via RubyGems
as <em>ruby-nagios</em></p>

<h1>Using on the CLI?</h1>

<p>Find out what services match a regular expression:</p>

<pre><code>nagsrv --list-services --with-service /puppet/
puppet-freshness
puppetd
puppetmaster
</code></pre>

<p>Find hosts with the service /puppet/:</p>

<pre><code>nagsrv --list-hosts --with-service /puppet/
dev1.your.net
dev2.your.net
.
.
</code></pre>

<p>Disable notifications for them all on all hosts:</p>

<pre><code>nagsrv.rb --disable-notify --with-service /puppet/
[1263129006] DISABLE_SVC_NOTIFICATIONS;dev1.your.net;puppet-freshness
[1263129006] DISABLE_SVC_NOTIFICATIONS;dev1.your.net;puppetd
[1263129006] DISABLE_SVC_NOTIFICATIONS;dev1.your.net;puppet-freshness
.
.
.
</code></pre>

<p>Only do it for hosts matching /dev2/:</p>

<pre><code>nagsrv.rb --disable-notify --with-service /puppet/ --for-host /dev2/
[1263129038] DISABLE_SVC_NOTIFICATIONS;dev2.your.net;puppet-freshness
[1263129038] DISABLE_SVC_NOTIFICATIONS;dev2.your.net;puppetd
</code></pre>

<p>You can do ack's, force checks etc, see the help or
comments in the nagsrv.rb script. To actually get
nagios to do these actions just redirect the output
from these commands to the Nagios CMD file. On my
machine that is /var/log/nagios/rw/nagios.cmd.</p>

<h1>Using from Ruby?</h1>

<p>You can also do the same from within Ruby easily,
the library lets you search host by any property
on a service, here we'll find all hosts with
service /puppet/ on host /dev2/:</p>

<pre><code>require 'rubygems'
require 'nagios/status'
nagios = Nagios::Status.new
nagios.parsestatus("status.log")

options = {:forhost =&gt; "/dev2/", :action =&gt; "${host}",
           :withservice =&gt; "/puppet/"}
services = nagios.find_services(options)

puts services.join("\n")
</code></pre>

<p>This will in this case just print:</p>

<pre><code>dev2.your.net
</code></pre>

<p>If you didn't specify the :action string it would
just return an array of services found. The :action
string is a template that lets you return the matches
in any format you like, here's a template to Acknowledge
services:</p>

<pre><code>"[${tstamp}] ACKNOWLEDGE_SVC_PROBLEM;;${host};${service};1 \
 ;0;1;#{ENV['USER']};Acknowledged from CLI"
</code></pre>

<p>The only variables it supports now is ${host}, ${service}
and ${tstamp} we can easily add more if needed.</p>

<h1>Contact?</h1>

<p>R.I.Pienaar / rip@devco.net / <a href="https://github.com/ripienaar" class="user-mention">@ripienaar</a> / <a href="http://devco.net/">http://devco.net/</a></p>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/ripienaar">ripienaar</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
    
  </body>
</html>